{% extends 'base.html.twig' %}

{% block title %}Nuevo Siniestro{% endblock %}

{% block body %}
<div class="card shadow-sm p-4">
    <h2 class="text-primary mb-3">Registrar nuevo siniestro</h2>

    {{ form_start(form) }}
        <div class="row">
            <div class="col-md-6">
                {{ form_row(form.fecha) }}
                {{ form_row(form.localidad) }}
                {{ form_row(form.clima) }}
            </div>
            <div class="col-md-6">
                {{ form_row(form.calle) }}
                {{ form_row(form.altura) }}
                {{ form_row(form.descripcion) }}
            </div>
        </div>

        <h4 class="mt-4">Detalles del siniestro</h4>
        <div data-prototype="{{ form_widget(form.detalleSiniestros.vars.prototype)|e('html_attr') }}">
            {{ form_widget(form.detalleSiniestros) }}
        </div>

        <div class="mt-3 d-flex gap-2">
            <button type="submit" class="btn btn-primary">Guardar</button>
            <button type="button" id="add-detalle" class="btn btn-success">Agregar otro detalle</button>
        </div>
    {{ form_end(form) }}
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const container = document.querySelector('[data-prototype]');
    const addButton = document.getElementById('add-detalle');
    let index = container.children.length;

    addButton.addEventListener('click', () => {
        const prototype = container.dataset.prototype.replace(/__name__/g, index);
        const newForm = document.createElement('div');
        newForm.innerHTML = prototype;
        container.appendChild(newForm);
        index++;
    });
});
</script>
{% endblock %}
