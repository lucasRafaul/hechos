{% extends 'base.html.twig' %}

{% block title %}Nuevo Detalle de Siniestro{% endblock %}

{% block body %}
<div class="card shadow-sm p-4">
    <h2 class="text-primary mb-4">Registrar Detalle de Siniestro</h2>

    {{ form_start(form, {attr: {'id': 'detalle-form'}}) }}
    <div id="detalle-container">
        <div class="detalle-item border rounded p-3 mb-3 bg-light">
            <div class="row">
                <div class="col-md-6">
                    {{ form_row(form.id_siniestro) }}
                    {{ form_row(form.id_persona) }}
                    {{ form_row(form.rol) }}
                </div>
                <div class="col-md-6">
                    {{ form_row(form.tipo_vehiculo) }}
                    {{ form_row(form.estadoAlcoholico) }}
                    {{ form_row(form.porcentajeAlcohol) }}
                    {{ form_row(form.observaciones) }}
                </div>
            </div>
            <div class="text-end mt-2">
                <button type="button" class="btn btn-success add-detalle">
                    âž• AÃ±adir otro detalle
                </button>
            </div>
        </div>
    </div>

    <button type="submit" class="btn btn-primary mt-3">ðŸ’¾ Guardar</button>
    {{ form_end(form) }}
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const container = document.getElementById('detalle-container');

    container.addEventListener('click', (e) => {
        if (e.target.classList.contains('add-detalle')) {
            const item = e.target.closest('.detalle-item');
            const clone = item.cloneNode(true);

            // limpiar valores
            clone.querySelectorAll('input, select, textarea').forEach(el => el.value = '');

            container.appendChild(clone);
        }
    });

    // Mostrar/ocultar campo porcentaje segÃºn estado alcohÃ³lico
    const togglePorcentaje = (select) => {
        const porcentajeDiv = select.closest('.detalle-item').querySelector('[id$="_porcentajeAlcohol"]').closest('.form-group, div');
        if (select.value === 'Positivo') {
            porcentajeDiv.style.display = 'block';
        } else {
            porcentajeDiv.style.display = 'none';
            porcentajeDiv.querySelector('input').value = 0;
        }
    };

    document.querySelectorAll('[id$="_estadoAlcoholico"]').forEach(select => {
        select.addEventListener('change', () => togglePorcentaje(select));
        togglePorcentaje(select);
    });
});
</script>
{% endblock %}



{# <h2>Asignar Persona a Siniestro</h2>
<form method="post">
    <input type="number" name="id_persona" placeholder="ID Persona">
    <input type="number" name="id_siniestro" placeholder="ID Siniestro">
    <input type="text" name="rol" placeholder="Rol (autor, vÃ­ctima, testigo)">
    <input type="text" name="estado_alcoholico" placeholder="Estado alcohÃ³lico">
    <input type="number" step="0.01" name="porcentaje_alcohol" placeholder="% Alcohol">
    <textarea name="observaciones" placeholder="Observaciones"></textarea>
    <button type="submit" class="btn btn-primary">Guardar</button>
</form> #}
